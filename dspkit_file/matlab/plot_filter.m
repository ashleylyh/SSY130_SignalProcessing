close all;
clc;
if ~ exist(fullfile(pwd,'images'),'dir'), mkdir images; end
h_reversedOrder_BB_full = [-.00215686;
        -.000338629;
        .00120097;
        .00233086;
        .00270262;
        .00289784;
        .0028333;
        .00286812;
        .00273787;
        .00221602;
        .00166554;
        .000905706;
        .000227661;
        -4.6597e-5;
        -.000596544;
        -.000568773;
        -.000110951;
        -9.91957e-5;
        -.000187978;
        -.000736488;
        -.00217947;
        -.00372665;
        -.00492334;
        -.00610065;
        -.00660802;
        -.00641812;
        -.0061574;
        -.00548766;
        -.00503206;
        -.00540669;
        -.00555536;
        -.00608644;
        -.00666502;
        -.00604582;
        -.00505088;
        -.00338963;
        -.000678661;
        .000914293;
        .00161294;
        .00264155;
        .00400973;
        .00710533;
        .00997449;
        .0110865;
        .011959;
        .013499;
        .01437;
        .0129008;
        .010227;
        .00788016;
        .00873017;
        .0123433;
        .0135395;
        .0121574;
        .00966037;
        .00691991;
        .00526697;
        .0012025;
        -.00553806;
        -.0105394;
        -.0164988;
        -.0224755;
        -.0247927;
        -.0247292;
        -.0204532;
        -.0150302;
        -.0129432;
        -.0103486;
        -.00358191;
        .00752905;
        .0183431;
        .0204146;
        .0135793;
        .00485778;
        -.000937852;
        -.00210526;
        -.000492387;
        .000251571;
        -.00014849;
        -.000428738;
        -.000433988;
        -.000343138;
        -.000346684;
        -.000333834;
        -.000340739;
        -.000324358;
        -.000327119;
        -.000277425;
        -.0003297;
        -.000296873;
        -.000259911;
        -.00021805;
        -.000185247;
        -.000235213;
        -.000177844;
        -.000171518;
        -2.14137e-5;
        2.94701e-6;
        -5.91838e-5;
        -.000181814;
        -.000177899;
        -.000140619;
        -.000127249;
        -.000103027;
        -.00018298;
        -.000306957;
        -.000287806;
        -.000200421;
        -9.53321e-5;
        3.33885e-5;
        -2.61636e-5;
        -5.69531e-5;
        -.000151486;
        -.000284678;
        -.000231088;
        -.000322049;
        -.000361783;
        -.000372629;
        -.000414153;
        -.000349757;
        -.000402473;
        -.000182193;
        -.000214891;
        -.000218312;
        -.000136544;
        -.000153254;
        -1.42141e-5;
        3.05342e-5];

h_reversedOrder_sin_full = [-.000101825;
        -.0002706;
        -.000432483;
        -.000581641;
        -.000713804;
        -.000825703;
        -.000912136;
        -.000972716;
        -.00100451;
        -.00100674;
        -.000979151;
        -.000920929;
        -.000835916;
        -.000724274;
        -.000590941;
        -.000438835;
        -.000273559;
        -9.76636e-5;
        8.05606e-5;
        .000259738;
        .000430338;
        .000589588;
        .000732544;
        .00085456;
        .000951005;
        .00101963;
        .00105862;
        .00106597;
        .00104047;
        .000984192;
        .000897933;
        .000785204;
        .000648717;
        .000491881;
        .000319937;
        .000138015;
        -4.93673e-5;
        -.0002353;
        -.00041695;
        -.000585361;
        -.000737611;
        -.000868271;
        -.000973475;
        -.00105001;
        -.00109649;
        -.0011096;
        -.00109057;
        -.00103841;
        -.000955804;
        -.000843709;
        -.000705881;
        -.000547106;
        -.000370057;
        -.000182229;
        1.34222e-5;
        .000209881;
        .000400839;
        .000581614;
        .000745731;
        .000888587;
        .00100538;
        .00109278;
        .00114812;
        .00116823;
        .00115412;
        .00110418;
        .00102185;
        .000907855;
        .000766643;
        .000602097;
        .000418388;
        .000222384;
        1.81834e-5;
        -.000186659;
        -.000387597;
        -.000577659;
        -.000752125;
        -.000904216;
        -.00103121;
        -.00112788;
        -.00119231;
        -.00122032;
        -.00121277;
        -.0011686;
        -.00108941;
        -.000977115;
        -.000834919;
        -.000666486;
        -.000476483;
        -.000272371;
        -5.80151e-5;
        .000158565;
        .000370528;
        .000574109;
        .000760168;
        .000925002;
        .00106107;
        .00116777;
        .00123837;
        .00127364;
        .00127067;
        .00122952;
        .00115189;
        .00103879;
        .000894896;
        .00072291;
        .000527563;
        .000316037;
        9.30947e-5;
        -.000132429;
        -.000355356;
        -.000568475;
        -.000765995;
        -.000941122;
        -.00108877;
        -.00120382;
        -.0012832;
        -.00132471;
        -.00132725;
        -.00129008;
        -.00121436;
        -.00110203;
        -.000955938;
        -.000780237;
        -.000581045;
        -.000361686;
        -.000131003;
        .000105105];

h_reversedOrder_sin100to10_100 = [-.00310512;
        -.00349779;
        -.00378804;
        -.00396634;
        -.00402641;
        -.00396576;
        -.00378702;
        -.00349227;
        -.00309222;
        -.00259761;
        -.00202308;
        -.00138505;
        -.000702877;
        4.04853e-6;
        .000714074;
        .00140637;
        .00206013;
        .00265481;
        .00317438;
        .00360005;
        .00392086;
        .00412522;
        .00420721;
        .00416372;
        .00399523;
        .00370698;
        .00330556;
        .00280465;
        .0022157;
        .00155949;
        .000852336;
        .000116973;
        -.000626723;
        -.00135516;
        -.00204505;
        -.00267916;
        -.00323443;
        -.00369632;
        -.00404986;
        -.00428382;
        -.0043898;
        -.00436547;
        -.00421006;
        -.00392836;
        -.00352668;
        -.00301848;
        -.00241737;
        -.00173942;
        -.00100652;
        -.000240175;
        .000537081;
        .00130274;
        .00203234;
        .00270516;
        .0032996;
        .00379839;
        .0041856;
        .00444961;
        .00458268;
        .00457782;
        .00443709;
        .00416244;
        .00376213;
        .00324793;
        .00263296;
        .00193622;
        .00117861;
        .000382807;
        -.00042941;
        -.00123182;
        -.0020021;
        -.00271583;
        -.0033516;
        -.00389062;
        -.00431539;
        -.00461303;
        -.00477387;
        -.00479353;
        -.00466932;
        -.004406;
        -.00400861;
        -.00349125;
        -.00286588;
        -.00215306;
        -.001373;
        -.00054692;
        .000297906;
        .00113781;
        .00194791;
        .0027022;
        .00337902;
        .00395882;
        .00442103;
        .00475312;
        .00494476;
        .00498932;
        .00488482;
        .00463255;
        .00424191;
        .00372176];

h_reversedOrder_sin100to10_10 = [.0287304;
        .0317414;
        .0338118;
        .0348765;
        .0349059;
        .0338931;
        .0318671;
        .0288868;
        .0250401;
        .0204386];

h_reversedOrder_sin10to100_100 = [.000368009;
        .00024108;
        .00012252;
        -2.84762e-5;
        -.000149839;
        -.000259263;
        -.000401931;
        -.000532414;
        -.000655807;
        -.000712403;
        -.000756926;
        -.000812224;
        -.000828656;
        -.00081154;
        -.000749519;
        -.000711704;
        -.000570252;
        -.000487557;
        -.0003512;
        -.000239422;
        -6.17307e-5;
        7.15477e-5;
        .000208058;
        .000314531;
        .000459501;
        .000550263;
        .000644497;
        .000729539;
        .000766203;
        .000787139;
        .000783957;
        .0007772;
        .000713522;
        .000639315;
        .000522486;
        .000398631;
        .000289728;
        .000187303;
        3.5102e-5;
        -.000124514;
        -.000246902;
        -.00033463;
        -.000428624;
        -.000558436;
        -.000645188;
        -.000606286;
        -.000753981;
        -.000775393;
        -.000786981;
        -.000734954;
        -.000687827;
        -.000706295;
        -.000465928;
        -.000369331;
        -.000253117;
        -.000129845;
        -9.95142e-5;
        6.37748e-5;
        .000215253;
        .000300423;
        .000415789;
        .000483561;
        .000589527;
        .000650163;
        .000657187;
        .000510686;
        .000569395;
        .000294018;
        .000407577;
        .000221639;
        .000246923;
        9.14296e-5;
        .000406416;
        .000668202;
        .000818722;
        .00109515;
        .00117938;
        .00130393;
        .00119233;
        .00101416;
        .000869528;
        .000724593;
        .000390257;
        4.12297e-5;
        -.000174834;
        -.000427706;
        -.000741286;
        -.00103713;
        -.00129109;
        -.000160837;
        .00850564;
        .0131113;
        .0173263;
        .0210335;
        .0241079;
        .0264798;
        .0280511;
        .0287966;
        .0286817;
        .0276945];

h_reversedOrder_sin10to100_10 = [-.00174872;
        .00479187;
        .0111923;
        .017261;
        .0228167;
        .0276947;
        .0317483;
        .0348565;
        .0369266;
        .037895];

h_reversedOrder_Q6 = [-.0734897;
        -.0605494;
        -.000709424;
        .0570418;
        .0418246;
        -.03617;
        -.0329888;
        -.043582;
        -.0197119;
        -.00506515;
        .0357205;
        .0475527;
        .0298534;
        -.0278767;
        -.0819152;
        -.0292873;
        -.0220332;
        .020773;
        .0403723;
        .0346894;
        -.00973895;
        -.0541879;
        -.0336625;
        -.0411411;
        -.000995126;
        .047597;
        .0476612;
        .000383148;
        -.036934;
        -.0143674;
        .0224841;
        -.0184305;
        -.0343973;
        .0701587;
        .0924204;
        .0414123;
        -.0310509;
        -.0382041;
        -.0379339;
        -.0162404;
        .0553455;
        .0329321;
        .0349654;
        .0135538;
        .0308578;
        -.027985;
        -.0406299;
        .026478;
        .0383039;
        -.0114742;
        -.0324531;
        .0595963;
        -.00270466;
        -.0804782;
        -.0544375;
        .0680897;
        .139908;
        .106565;
        .0100723;
        -.0277616;
        -.014032;
        -.00110425;
        -.125421;
        -.107328;
        .0168404;
        .0435832;
        -.0404471;
        -.2003;
        -.138424;
        .0207122;
        .129933;
        .0843116;
        .0287979;
        -.0288097;
        -.0245188;
        .0234315;
        -.0211699;
        -.0252575;
        .0135772;
        .0850062;
        .0102047;
        -.0575315;
        -.00148432;
        .0173145;
        .0314673;
        -.0341483;
        .0368624;
        .0214323;
        -.00928831;
        .0254168;
        .0294572;
        .0219;
        -.0280336;
        .0228499;
        .0628459;
        .0207308;
        -.00252981;
        .0202027;
        -.0332404;
        -.0286851;
        .0169474;
        .0103572;
        .0192895;
        -.0176651;
        .00979173;
        -.064297;
        -.0438581;
        .0301664;
        .0199267;
        .025559;
        -.0285199;
        .00952789;
        -.0220806;
        -.0430006;
        -.00591334;
        -.0133101;
        .0427202;
        .0389021;
        .0021706;
        -.0517414;
        -.0560494;
        .025332;
        -.0135512;
        .011959;
        -.0040354;
        -.00352651;
        -.0314856;
        -.0393109];

h_reversedOrder_bbtosin = [.00309221;
        .00198969;
        -.00281035;
        -.0103874;
        -.00671241;
        -.002635;
        -.000380178;
        .00271828;
        .000133422;
        -.00163538;
        -.000245867;
        -.00626836;
        -.00754985;
        .00180063;
        .00427361;
        -.000868652;
        -.002723;
        -.00389586;
        -.000230004;
        .00516255;
        .00557548;
        .00573518;
        .00115446;
        -.00172886;
        .00369759;
        .00301666;
        -.00218064;
        .00124358;
        .00647226;
        -.000452672;
        -.00139094;
        .00282054;
        -.000696788;
        -.000175721;
        .00430488;
        .0014583;
        -.0113129;
        -.0212803;
        -.0170073;
        -.0101563;
        -.0212475;
        -.0129012;
        .00968955;
        .00492851;
        -.00231997;
        -.000857336;
        .00554378;
        .0194646;
        .0216776;
        -.00250218;
        -.0212421;
        -.010796;
        .026483;
        .0429731;
        .000978661;
        -.0156058;
        .0440867;
        .0667945;
        .0403723;
        .0257452;
        -.00664862;
        -.0248112;
        -.0213058;
        -.0545409;
        -.0728042;
        -.0359151;
        -.00855995;
        -.0206768;
        -.0727898;
        -.0752219;
        .0198213;
        .0946498;
        .074255;
        .0263035;
        -.0140739;
        -.0251716;
        .0086696;
        .0164485;
        -.00544166;
        -.0123311;
        .000314578;
        .00660266;
        -.000195856;
        -.00444386;
        -.00137535;
        .00137367;
        .000273426;
        -.00133956;
        -.00114668;
        -.000179601;
        -.000261336;
        -.000686566;
        -.000922252;
        -.000743202;
        -.000403238;
        -.000372186;
        -.000663879;
        -.000648806;
        -.000488898;
        -.000462963;
        -.000515461;
        -.000547675;
        -.000588904;
        -.000622378;
        -.000543346;
        -.000568595;
        -.000619337;
        -.000497235;
        -.000396226;
        -.000424029;
        -.000604728;
        -.000618365;
        -.000627427;
        -.000524957;
        -.000461135;
        -.000540168;
        -.000468421;
        -.000355984;
        -.000142744;
        5.57613e-6;
        -.000130151;
        -.000192525;
        -.000196323;
        -9.6387e-5;
        -.000203301;
        -.000299156;
        -.000420612;
        -.000301696];


h_reversedOrder_sintoBB = [-.00727334;
        -.00162798;
        -.00581658;
        -.0108996;
        -.00798599;
        .00566227;
        .0143311;
        .00943751;
        -.00174597;
        -.00480878;
        -.000802969;
        .00129647;
        -.00120024;
        -.00585414;
        -.00802725;
        -.0047703;
        .000338864;
        .000939918;
        -.00276256;
        -.00474623;
        -.00205731;
        .00306817;
        .00929291;
        .00993766;
        .00148198;
        -.00525282;
        -.00501832;
        .00222318;
        .010019;
        .00612359;
        -.00328158;
        -.00657817;
        -.00400629;
        .00391551;
        .00812855;
        .00194477;
        -.00321161;
        -.00175836;
        .00310654;
        .00884437;
        .00573015;
        -.00355959;
        -.00594576;
        -.00229034;
        -.000349416;
        -.00539745;
        -.0165781;
        -.0255078;
        -.0173139;
        -.00517563;
        -.000640064;
        .0051719;
        .000946949;
        -.00198602;
        .00120508;
        -.0041867;
        .00870946;
        .028556;
        .0174328;
        -.00836388;
        -.021764;
        -.0154605;
        .0112303;
        .0315679;
        .0277632;
        .0300052;
        .0380516;
        .0362231;
        .0298168;
        .0138162;
        -.0105954;
        -.0142634;
        -.0334194;
        -.0603645;
        -.0317769;
        -.0245174;
        -.0416909;
        -.0573471;
        -.0746763;
        -.0171532;
        .0722336;
        .0868922;
        .0465176;
        .00408774;
        -.0231948;
        -.00735051;
        .0150414;
        .00536948;
        -.0073146;
        -.00462764;
        .00302603;
        .00291287;
        -.000828463;
        -.00143302;
        .000157233;
        .000888731;
        .00042333;
        -6.9658e-5;
        .00016399;
        .000297529;
        .000242604;
        .000255505;
        .000158709;
        3.36928e-5;
        .000152792;
        .000214895;
        .000103204;
        .000122511;
        -4.74815e-5;
        5.12578e-5;
        .000171619;
        .00015428;
        .000119331;
        6.44242e-5;
        .000471165;
        .000433387;
        .00038129;
        .00023252;
        .000154072;
        .000299809;
        .0004574;
        .000339909;
        -2.0664e-5;
        5.76738e-5;
        .000264551;
        .000287711;
        .000103603;
        .000160792];

% Filter coefficients
%h = [h0, h1, ..., hN];  % Replace h0, h1, ..., hN with your filter coefficients
h = h_reversedOrder_sin_full;
%h = flip(h);
% Constants
fs = 16000; % Sampling frequency in Hz
f0 = 440;  % Frequency of interest in Hz

% Compute DFT of filter coefficients
N = length(h);
H = fft(h);

% Evaluate frequency response at specific frequency
k0 = round(f0 * N / fs);  % Compute DFT index for f0
Hsin_f0 = H(k0+1);       % Retrieve frequency response at k0

% Compute magnitude and phase
magnitude = abs(Hsin_f0);
phase = angle(Hsin_f0);

% Display the results
disp(['Magnitude at f0 = ', num2str(f0), ' Hz: ', num2str(magnitude)]);
disp(['Phase at f0 = ', num2str(f0), ' Hz: ', num2str(phase)]);




%% Question 2

f_s = 16000;    % Hz
h = flipud(h_reversedOrder_sintoBB);
[H,w] = freqz(h,1,512,f_s); %'whole',


figure('Color','white')
stem(0:numel(h)-1, h); grid on;
xlabel 'Samples', ylabel 'h(n) - Filter coefficients', title 'Estimated Filter h(n)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','h-coeffs'),'epsc')

figure('Color','white');
subplot(2,1,1);
plot(w/f_s,20*log10(abs(H))); grid on;
xlabel 'Normalized Frequency (\times \pi [rad/sample])', ylabel 'Magnitude (dB)', title 'Estimated Filter H(w)'
subplot(2,1,2)
plot(w/f_s, 180/pi*wrapToPi(angle(H))); grid on;
xlabel 'Normalized Frequency (\times \pi [rad/sample])', ylabel 'Phase (degrees)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','H'),'epsc')






%% Question 3

f_s = 16000;    % Hz
h = [1 0 0 0.5];
[H,w] = freqz(h,1,512,f_s); %'whole',

figure('Color','white');
subplot(2,1,1);
plot(w/f_s,20*log10(abs(H))); grid on;
xlabel 'Normalized Frequency (\times \pi [rad/sample])', ylabel 'Magnitude (dB)', title 'Frequency response H(w) of h = [1, 0, 0, 0.5]'
subplot(2,1,2)
plot(w/f_s, 180/pi*wrapToPi(phase(H))); grid on;
xlabel 'Normalized Frequency (\times \pi [rad/sample])', ylabel 'Phase (degrees)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','H-echo'),'epsc')


%% Question 6


f_s = 16000;    % Hz

h = flipud(h_reversedOrder_max);
figure('Color','white')
stem(0:numel(h)-1, h); grid on;
xlabel 'Samples', ylabel 'h(n) - Filter coefficients', title 'Estimated Filter h(n)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','h-coeffs-SIN-MAX'),'epsc')

h = flipud(h_reversedOrder_100);
figure('Color','white')
stem(0:numel(h)-1, h); grid on;
xlabel 'Samples', ylabel 'h(n) - Filter coefficients', title 'Estimated Filter h(n)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','h-coeffs-SIN-100'),'epsc')

h = flipud(h_reversedOrder_10);
figure('Color','white')
stem(0:numel(h)-1, h); grid on;
xlabel 'Samples', ylabel 'h(n) - Filter coefficients', title 'Estimated Filter h(n)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','h-coeffs-SIN-10'),'epsc')

[H,w] = freqz(h,1,512,f_s); %'whole',
figure('Color','white');
subplot(2,1,1);
plot(w/f_s,20*log10(abs(H))); grid on;
xlabel 'Normalized Frequency (\times \pi [rad/sample])', ylabel 'Magnitude (dB)', title 'Estimated Filter H(w)'
subplot(2,1,2)
plot(w/f_s, 180/pi*wrapToPi(angle(H))); grid on;
xlabel 'Normalized Frequency (\times \pi [rad/sample])', ylabel 'Phase (degrees)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','H-SIN-MAX'),'epsc')

%%%%%%%%%%%%

h = flipud(h_reversedOrder_MAX_inc);
figure('Color','white')
stem(0:numel(h)-1, h); grid on;
xlabel 'Samples', ylabel 'h(n) - Filter coefficients', title 'Estimated Filter h(n)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','h-coeffs-SIN-MAX-inc'),'epsc')

h = flipud(h_reversedOrder_100_inc);
figure('Color','white')
stem(0:numel(h)-1, h); grid on;
xlabel 'Samples', ylabel 'h(n) - Filter coefficients', title 'Estimated Filter h(n)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','h-coeffs-SIN-100-inc'),'epsc')

h = flipud(h_reversedOrder_10_inc);
figure('Color','white')
stem(0:numel(h)-1, h); grid on;
xlabel 'Samples', ylabel 'h(n) - Filter coefficients', title 'Estimated Filter h(n)'
set(gca,'LooseInset',get(gca,'TightInset'))
saveas(gcf, fullfile(pwd,'images/','h-coeffs-SIN-10-inc'),'epsc')
